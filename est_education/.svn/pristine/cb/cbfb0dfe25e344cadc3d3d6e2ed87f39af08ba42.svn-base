<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="erpProject">
	<!-- 멤버 - 목록 조회 -->
	<select id="selectProjectList" parameterType="hashMap" resultType="com.erp.admin.business.project.vo.ErpProjectVo">
		<![CDATA[
			SELECT 
				  PRJCT_SQ
				  ,MBR_SQ
				  ,PRJCT_NM
				  ,PRJCT_TYP
				  ,PRJCT_STRT_DT
				  ,PRJCT_END_DT
				  ,PRJCT_ADDR
			FROM 
				EDUCATION.TB_EEP_PRJCT_M
		  ]]>
		  <where>
			<if test="PRJCT_TYP != NULL">
		    	PRJCT_TYP = #{PRJCT_TYP}
		    </if>
		    <choose>
		    <when test="MBR_SQ != NULL and PRJCT_NM != NULL and PRJCT_ADDR != NULL">
		    	AND (MBR_SQ LIKE CONCAT('%', #{MBR_SQ}, '%')
		    		OR PRJCT_NM LIKE CONCAT('%', #{PRJCT_NM}, '%')
		    		OR PRJCT_ADDR LIKE CONCAT('%', #{PRJCT_ADDR}, '%'))
		    </when>
		    <otherwise>
		    <if test="MBR_SQ != NULL">
		    	AND MBR_SQ LIKE CONCAT('%', #{MBR_SQ}, '%')
		    </if>
			<if test="PRJCT_NM != NULL">
		    	AND PRJCT_NM LIKE CONCAT('%', #{PRJCT_NM}, '%') 
		    </if>
			<if test="PRJCT_ADDR != NULL">
		    	AND PRJCT_ADDR LIKE CONCAT('%', #{PRJCT_ADDR}, '%') 
		    </if>
		    </otherwise>
		    </choose>
		</where>
		ORDER BY PRJCT_SQ > 0
			LIMIT
				#{start},#{end}
	</select>
	
	<select id="selectProjectPagingList" parameterType="hashMap" resultType="com.erp.admin.business.project.vo.ErpProjectVo">
	<![CDATA[
		SELECT 
					PRJCT_SQ
				 	,MBR_SQ
				 	,PRJCT_NM
				 	,PRJCT_TYP
				 	,PRJCT_STRT_DT
				 	,PRJCT_END_DT
				 	,PRJCT_ADDR
		FROM 
			EDUCATION.TB_EEP_PRJCT_M
	  ]]>
	  <where>
			<if test="PRJCT_TYP != NULL">
		    	PRJCT_TYP = #{PRJCT_TYP}
		    </if>
		    <choose>
		    <when test="MBR_SQ != NULL and PRJCT_NM != NULL and PRJCT_ADDR != NULL">
		    	AND (MBR_SQ LIKE CONCAT('%', #{MBR_SQ}, '%')
		    		OR PRJCT_NM LIKE CONCAT('%', #{PRJCT_NM}, '%')
		    		OR PRJCT_ADDR LIKE CONCAT('%', #{PRJCT_ADDR}, '%'))
		    </when>
		    <otherwise>
		    <if test="MBR_SQ != NULL">
		    	AND MBR_SQ LIKE CONCAT('%', #{MBR_SQ}, '%')
		    </if>
			<if test="PRJCT_NM != NULL">
		    	AND PRJCT_NM LIKE CONCAT('%', #{PRJCT_NM}, '%') 
		    </if>
			<if test="PRJCT_ADDR != NULL">
		    	AND PRJCT_ADDR LIKE CONCAT('%', #{PRJCT_ADDR}, '%') 
		    </if>
		    </otherwise>
		    </choose>
		</where>
		
		ORDER BY PRJCT_SQ > 0
			LIMIT
				#{start},#{end}
	</select>
	<select id="getCountProjectPagingList" parameterType="hashMap" resultType="int">
	<![CDATA[
		SELECT 
			count(mbr_sq)
		FROM 
			EDUCATION.TB_EEP_PRJCT_M
	  ]]>
	  <where>
			<if test="PRJCT_TYP != NULL">
		    	PRJCT_TYP = #{PRJCT_TYP}
		    </if>
		    <choose>
		    <when test="MBR_SQ != NULL and PRJCT_NM != NULL and PRJCT_ADDR != NULL">
		    	AND (MBR_SQ LIKE CONCAT('%', #{MBR_SQ}, '%')
		    		OR PRJCT_NM LIKE CONCAT('%', #{PRJCT_NM}, '%')
		    		OR PRJCT_ADDR LIKE CONCAT('%', #{PRJCT_ADDR}, '%'))
		    </when>
		    <otherwise>
		    <if test="MBR_SQ != NULL">
		    	AND MBR_SQ LIKE CONCAT('%', #{MBR_SQ}, '%')
		    </if>
			<if test="PRJCT_NM != NULL">
		    	AND PRJCT_NM LIKE CONCAT('%', #{PRJCT_NM}, '%') 
		    </if>
			<if test="PRJCT_ADDR != NULL">
		    	AND PRJCT_ADDR LIKE CONCAT('%', #{PRJCT_ADDR}, '%') 
		    </if>
		    </otherwise>
		    </choose>
		</where>
	</select>
		
	<insert id="insertProject" parameterType="com.erp.admin.business.project.vo.ErpProjectVo" useGeneratedKeys="true" keyProperty="prjctSq">
		INSERT INTO EDUCATION.TB_EEP_PRJCT_M(
			MBR_SQ,
			PRJCT_NM,
			PRJCT_TYP,
			PRJCT_ROLE,
			PRJCT_STRT_DT,
			PRJCT_END_DT,
			PRJCT_ADDR,
			PRJCT_MKTG_PT,
			PRJCT_WRKPL
			)
		VALUES(
			#{mbrSq},
			#{prjctNm},
			#{prjctTyp},
			#{prjctRole},
			#{prjctStrtDt},
			#{prjctEndDt},
			#{prjctAddr},
			#{prjctMktgPt},
			#{prjctWrkpl}	
			)
	</insert>
	
	<update id="updateProject" parameterType="com.erp.admin.business.project.vo.ErpProjectVo" >
		UPDATE EDUCATION.TB_EEP_PRJCT_M
			SET
				MBR_SQ = #{mbrSq},
				PRJCT_NM = #{prjctNm},
				PRJCT_TYP = #{prjctTyp},
				PRJCT_ROLE = #{prjctRole},
				PRJCT_STRT_DT = #{prjctStrtDt},
				PRJCT_END_DT = #{prjctEndDt},
				PRJCT_ADDR = #{prjctAddr},
				PRJCT_MKTG_PT = #{prjctMktgPt},
				PRJCT_WRKPL = #{prjctWrkpl}
			WHERE PRJCT_SQ = #{prjctSq}
	</update>
	<!--  게시글 전체 갯수 -->
    <select id="projectCountList" resultType="int" parameterType="hashMap">
        <![CDATA[
	        SELECT 
	        	COUNT(PRJCT_SQ)
	        FROM 
	        	EDUCATION.TB_EEP_PRJCT_M
	        
        ]]>
    </select>
	<delete id="deleteProject" parameterType="String" >
		DELETE
		FROM EDUCATION.TB_EEP_PRJCT_M
		WHERE PRJCT_SQ=#{prjctSq} 
	</delete>
	
	<delete id="deleteProjectAll" parameterType="java.util.List" >
		DELETE
		FROM EDUCATION.TB_EEP_PRJCT_M
		<where>
		<foreach collection="list" item="item" open="" close="" separator="OR">
			PRJCT_SQ=#{item.prjctSq}
		</foreach>
		</where>
	</delete>
	
	<select id="selectprojectOne" parameterType="String" resultType="com.erp.admin.business.project.vo.ErpProjectVo">
		<![CDATA[
			SELECT 
				  PRJCT_SQ
				  ,MBR_SQ
				  ,PRJCT_NM
				  ,PRJCT_TYP
				  ,PRJCT_ROLE
				  ,PRJCT_STRT_DT
				  ,PRJCT_END_DT
				  ,PRJCT_ADDR
				  ,PRJCT_MKTG_PT
				  ,PRJCT_WRKPL
			FROM EDUCATION.TB_EEP_PRJCT_M
			WHERE PRJCT_SQ = #{prjctSq}
		]]>
	</select>

</mapper>