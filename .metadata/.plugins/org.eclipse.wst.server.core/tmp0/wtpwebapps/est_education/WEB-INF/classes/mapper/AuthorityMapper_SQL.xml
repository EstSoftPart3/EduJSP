<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="authority">

	<!-- 권한 그룹 - 목록 조회 -->
	<select id="selectAuthorityGroupList" parameterType="hashmap" resultType="com.authority.vo.AuthorityVo">
		SELECT 
		      AUTH_CD
			, AUTH_NM
			, USE_YN
			, NOTE
		FROM EDU_JSP.TB_EST_AUTH
		<where>
		    <if test="keyWord != '' and keyWord != NULL">
		    	AND AUTH_CD LIKE CONCAT('%', #{keyWord}, '%') OR AUTH_NM LIKE CONCAT('%', #{keyWord}, '%')
		    </if>
		    <if test="useYn != 'ALL' and useYn != NULL">
		    	AND USE_YN = #{useYn}
		    </if>
		</where>
	</select>
	
	<!-- 사원 - 목록 조회 -->
	<select id="selectAuthorityMemberList" parameterType="hashmap" resultType="com.authority.vo.AuthorityMemberVo">

SELECT B.AUTH_CD
		,A.MBR_SQ AS memberSq
		,A.MBR_NM AS memberNm
		,A.MBR_DPRTMT_CD AS memberDprtmt
		,A.MBR_POSITN_CD AS memberPosition
FROM TB_EST_MBR AS A
LEFT OUTER JOIN TB_EST_AUTH_MBR_R AS B
ON A.MBR_SQ = B.MBR_SQ
WHERE B.AUTH_CD = #{authCd}

		
<!-- 		SELECT  -->
<!-- 		      MBR_SQ -->
<!-- 			, MBR_NM -->
<!-- 			, MBR_DPRTMT_CD -->
<!-- 			, MBR_POSITN_CD -->
<!-- 		FROM EDU_JSP.TB_EST_MBR -->
<!-- 		WHERE MBR_SQ = #{memberSq} -->
		<!-- <if test="isUse != 'ALL' and isUse != NULL"> -->
	    	<!-- AND CODE_IS_USE = #{isUse} -->
	    <!-- </if> -->
	</select>
	
	<!-- 권한그룹 - 추가 -->
	<insert id="insertAuthority" parameterType="com.authority.vo.AuthorityVo">
		INSERT INTO EDU_JSP.TB_EST_AUTH (
			  AUTH_CD
			, AUTH_NM
			, USE_YN
			, NOTE
		) VALUES (
			  #{authCd}
			, #{authNm}
			, #{useYn}
			, #{note}
		)
	</insert>
	
	<!-- 사원 - 추가 -->
	<insert id="insertMember" parameterType="com.authority.vo.AuthorityMemberVo">
		INSERT INTO EDU_JSP.TB_EST_MBR (
			  MBR_SQ
			, MBR_NM
			, MBR_DPRTMT_CD
			, MBR_POSITN_CD
		) VALUES (
			  #{memberSq}
			, #{memberNm}
			, #{memberDprtmt}
			, #{memberPosition}
		)
	</insert>
	
<!-- 	<insert id="insertAuthMember" parameterType="com.authority.vo.AuthorityMemberVo"> -->
<!-- 		INSERT INTO EDU_JSP.TB_EST_AUTH_MBR_R ( -->
<!-- 			  AUTH_CD -->
<!-- 			, MBR_SQ			 -->
<!-- 		) VALUES ( -->
<!-- 			  #{AUTH_CD} -->
<!-- 			, #{MER_SQ} -->
<!-- 		) -->
<!-- 	</insert> -->
	
<!-- 	<select id="selectMemberList" parameterType="hashmap" resultType="com.authority.vo.AuthorityMemberVo"> -->
<!-- 		SELECT  MBR_SQ AS memberSq -->
<!-- 			,MBR_NM AS memberNm -->
<!-- 			,MBR_DPRTMT_CD AS memberDprtmt -->
<!-- 			,MBR_POSITN_CD AS memberPosition -->
<!-- 		FROM TB_EST_MBR -->
<!-- 	</select> -->
	
	
	<!-- 권한그룹 - 수정 -->
	<update id="updateAuthority" parameterType="com.authority.vo.AuthorityVo">
		<![CDATA[
			UPDATE EDU_JSP.TB_EST_AUTH SET
			  AUTH_CD          = #{authCd}
			, AUTH_NM     	   = #{authNm}
			, USE_YN           = #{useYn}
			, NOTE             = #{note}
			WHERE AUTH_CD = #{authCd}
		]]>
	</update>
	
	<!-- 사원 - 수정 -->
	<update id="updateMember" parameterType="com.authority.vo.AuthorityMemberVo">
		<![CDATA[
			UPDATE EDU_JSP.TB_EST_MBR SET
			  MBR_SQ               = #{memberSq}
			, MBR_NM     		   = #{memberNm}
			, MBR_DPRTMT_CD        = #{memberDprtmt}
			, MBR_POSITN_CD        = #{memberPosition}
			WHERE AUTH_CD = #{authCd} and MBR_SQ = #{memberSq} 
		]]>
	</update>
	
	<!-- 권한그룹 - 삭제 -->
	<delete id="deleteAuthority" parameterType="com.authority.vo.AuthorityVo">
		<![CDATA[
			DELETE FROM EDU_JSP.TB_EST_AUTH
			WHERE AUTH_CD = #{authCd}
		]]>
	</delete>
	
	<!-- 사원 - 삭제 -->
	<delete id="deleteMember" parameterType="com.authority.vo.AuthorityMemberVo">
		<![CDATA[
			DELETE FROM EDU_JSP.TB_EST_AUTH_MBR_R
			WHERE MBR_SQ = #{memberSq}
		]]>
	</delete>
	
	
	

</mapper>